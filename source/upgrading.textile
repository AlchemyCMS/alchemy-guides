h2. Upgrading Alchemy CMS

This guide describes how to upgrade Alchemy CMS to version 2.9 and assumes that your current Alchemy version is v2.7 .

You should always upgrade from the next prior Alchemy release (based on your current version).

In contrast to v2.7 Alchemy 2.9 offers the opportunity to use a <strong>custom user model</strong> instead of the <strong>default user model</strong> (this is the mayor difference).

endprologue.

h3. Upgrading with default Alchemy user model

h4. Update the dependencies

In order to update the dependencies, the <code>Gemfile</code> needs to be changed first.

* The complete authentication part is extracted from the Alchemy core, so the <code>alchemy-devise</code> gem is necessary now.

That part of your updated Gemfile should look like this:

<ruby>
...
gem 'alchemy_cms', :github => 'magiclabs/alchemy_cms', :branch => '2.9-stable'
gem 'alchemy-devise', :github => 'magiclabs/alchemy-devise', :branch => '1.1-stable'
...
</ruby>

You should now update the dependencies via bundler.

<shell>
bundle update
</shell>

h4. Installing alchemy-devise migrations

In order to update the user model, the migrations of the alchemy-devise gem need to be copied to the App.

<shell>
bundle exec rake alchemy_devise:install:migrations
</shell>

h4. Run the Alchemy Upgrader

Now you can run the upgrade task.
While upgrading, you will get informations about the process on your screen.

<shell>
bundle exec rake alchemy:upgrade
</shell>

h5. Remove the Devise module configuration

<yaml>
# === Devise modules
#
# List of Devise modules that should be activated on the user model.
#
devise_modules:
  - :database_authenticatable
  - :trackable
  - :validatable
  - :timeoutable
  - :recoverable
  # - :encryptable # Uncomment this if you are upgrading from an Alchemy version < 2.5.0
</yaml>

h4. Adjust the user roles

The old role <code>registered</code> is now <code>member</code>

<yaml>
user_roles: [member, author, editor, admin]
</yaml>

h4. Add the regular expression for verifying email addresses

<yaml>
email_regexp: !ruby/regexp '/\A[^@\s]+@([^@\s]+\.)+[^@\s]+\z/'
</yaml>


h3. Upgrading to use custom user model

h4. Update the Gemfile

Adopt the url name to use the latest version

<ruby>
...
gem 'alchemy_cms', :github => 'magiclabs/alchemy_cms', :branch => '2.9-stable'
...
</ruby>

and update Alchemy:

<shell>
bundle update alchemy_cms
</shell>

h4. Execute the  Alchemy Upgrader

Now you can run the upgrade task.
While upgrading, you will get informations about the process on your screen.

<shell>
bundle exec rake alchemy:upgrade
</shell>

In order to tell Alchemy to use your own user model please follow the instructions in the chapter :
"Custom authentication":custom_authentication.html .

Finished, yay!
